<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PPE Dashboard | UMPSA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:#0a0a1a;
  color:#fff;
}
.container{max-width:1400px;margin:auto;padding:20px}

/* HEADER */
.header{
  background:linear-gradient(135deg,#0c2461,#1e3799);
  padding:25px;
  border-radius:15px;
  text-align:center;
  margin-bottom:30px;
  border:2px solid #00bcd4
}
.header h1{color:#00bcd4;margin:0;font-size:32px}
.header h2{opacity:.85;margin-top:5px}

/* STATS */
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:20px;margin-bottom:30px
}
.card{
  background:#1a1a2e;
  border-radius:15px;
  padding:25px;
  text-align:center;
  border:2px solid
}
.violation{border-color:#e74c3c}
.ok{border-color:#2ecc71}
.big{
  font-size:60px;
  font-weight:700;
  margin:15px 0
}
.violation .big{color:#e74c3c}
.ok .big{color:#2ecc71}

.detail{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px
}
.box{
  background:rgba(255,255,255,.05);
  border-radius:10px;
  padding:15px
}
.box span{font-size:24px;font-weight:700}

/* CONTROLS */
.controls{
  background:#1a1a2e;
  border-radius:15px;
  padding:20px;
  margin-bottom:20px;
  display:flex;
  gap:15px;
  flex-wrap:wrap;
  justify-content:center
}
button{
  padding:12px 25px;
  border:none;
  border-radius:8px;
  font-weight:600;
  cursor:pointer
}
.refresh{background:#3498db;color:#fff}

/* TABLE */
.table-wrap{
  background:#1a1a2e;
  padding:25px;
  border-radius:15px;
  overflow-x:auto
}
table{width:100%;border-collapse:collapse;min-width:1000px}
thead{background:#ff9800}
th,td{padding:15px;text-align:left}
tbody tr{border-bottom:1px solid #333}
.row{text-align:center;font-weight:700;color:#3498db}

.image{
  width:160px;height:100px;
  border-radius:8px;
  overflow:hidden;border:1px solid #444
}
.image img{width:100%;height:100%;object-fit:cover}

.badge{
  padding:6px 14px;
  border-radius:20px;
  font-size:12px;
  font-weight:700
}
.bad{background:rgba(231,76,60,.2);color:#e74c3c;border:1px solid}
.good{background:rgba(46,204,113,.2);color:#2ecc71;border:1px solid}

/* FOOTER */
.footer{
  margin-top:30px;
  padding:15px;
  text-align:center;
  opacity:.7;
  border-top:1px solid #333
}
</style>
</head>

<body>
<div class="container">

<div class="header">
<h1><i class="fas fa-hard-hat"></i> PREVENT HIGHWAY</h1>
<h2>PPE RECORD MONITORING SYSTEM</h2>
</div>

<div class="stats">
  <div class="card violation">
    <h3>TOTAL VIOLATIONS</h3>
    <div class="big" id="totalViolations">0</div>
    <div class="detail">
      <div class="box">Helmet<br><span id="helmetViolations">0</span></div>
      <div class="box">Glove<br><span id="gloveViolations">0</span></div>
    </div>
  </div>

  <div class="card ok">
    <h3>FULL PPE</h3>
    <div class="big" id="fullPPE">0</div>
    <div class="detail">
      <div class="box">Helmet OK<br><span id="helmetOK">0</span></div>
      <div class="box">Glove OK<br><span id="gloveOK">0</span></div>
    </div>
  </div>
</div>

<div class="controls">
<button class="refresh" onclick="loadData()">
<i class="fas fa-sync"></i> Refresh Data
</button>
<span id="status">Ready</span>
</div>

<div class="table-wrap">
<table>
<thead>
<tr>
<th>#</th>
<th>Date & Time</th>
<th>Image</th>
<th>Helmet</th>
<th>Glove</th>
<th>ID</th>
</tr>
</thead>
<tbody id="tableBody">
<tr><td colspan="6" align="center">Loading...</td></tr>
</tbody>
</table>
</div>

<div class="footer">
PPE Dashboard Â© UMPSA | <span id="lastUpdate">Never</span>
</div>

</div>

<script>
// ================= CONFIG =================
const API_URL =
"https://script.google.com/macros/s/AKfycbxdZP5SLc_bll16q6OHwpLkbORYrn65uiH01ls8JSadgQb5XsOXRj0F8FXqctWjcL-e/exec";

// ================= LOAD =================
async function loadData(){
document.getElementById("status").innerText="Loading...";
const res=await fetch(API_URL+"?action=getData");
const r=await res.json();

document.getElementById("totalViolations").innerText=r.stats.totalViolations;
document.getElementById("helmetViolations").innerText=r.stats.helmetViolations;
document.getElementById("gloveViolations").innerText=r.stats.gloveViolations;
document.getElementById("fullPPE").innerText=r.stats.fullPPE;
document.getElementById("helmetOK").innerText=r.stats.helmetOK;
document.getElementById("gloveOK").innerText=r.stats.gloveOK;

renderTable(r.data);
document.getElementById("status").innerText="Connected";
document.getElementById("lastUpdate").innerText=new Date().toLocaleTimeString();
}

// ================= TABLE =================
function renderTable(data){
const t=document.getElementById("tableBody");
t.innerHTML="";
data.forEach((d,i)=>{
t.innerHTML+=`
<tr>
<td class="row">${i+1}</td>
<td>${d.datetime}</td>
<td>
<div class="image">
<img src="${d.imageUrl}">
</div>
</td>
<td><span class="badge ${d.helmetStatus.includes("no")?"bad":"good"}">
${d.helmetStatus}
</span></td>
<td><span class="badge ${d.gloveStatus.includes("no")?"bad":"good"}">
${d.gloveStatus}
</span></td>
<td>${d.id}</td>
</tr>`;
});
}

loadData();
</script>
</body>
</html>
